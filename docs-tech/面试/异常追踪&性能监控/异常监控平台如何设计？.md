---
slug: /interview/error-tracking-and-performance-monitoring/how-to-design-an-exception-monitoring-platform
---

:::note åŸºæœ¬ç‚¹

1. é”™è¯¯é‡‡é›†
2. ä¸ŠæŠ¥
3. æ•°æ®æ±‡æ€»&æ¸…æ´—
4. æ•°æ®ç»Ÿè®¡
5. å¯è§†åŒ–
6. å‘Šè­¦

:::


## 1.é”™è¯¯é‡‡é›†

### å¸¸è§çš„ JavaScript é”™è¯¯

1. è¯­æ³•é”™è¯¯ `SyntaxError`

> ä¸€èˆ¬æ¥è¯´åœ¨å¼€å‘æ„å»ºé˜¶æ®µå°±ä¼šè¢«ç¼–è¯‘å™¨æ•è·ï¼Œå¦‚æœç”Ÿäº§éœ€è¦æ•è· `SyntaxError` çš„è¯ï¼Œéœ€è¦ä½¿ç”¨åˆ†å¼€çš„è„šæœ¬å»æ•è·
> 
> ```javascript
> <script>
>     // è¦æ•è·è¯­æ³•é”™è¯¯ï¼Œéœ€è¦ä½¿ç”¨åˆ†å¼€çš„ <script>
>     window.onerror = function(message, source, lineno, colno, error) {
>       console.log('æ•è·åˆ°å¼‚å¸¸ï¼š',{message, source, lineno, colno, error});
>     }
> </script>
> <script>
>   const notdefined,
> </script>
> ```
> 
> ç›‘æ§ä»£ç å’Œä¸šåŠ¡ä»£ç ä¸èƒ½æ”¾åœ¨åŒä¸€ä¸ª `<script>` æ ‡ç­¾ä¸­ï¼Œå¦åˆ™æ­¤æ—¶ onerror è¿˜æ²¡ç”Ÿæ•ˆï¼š[Can syntax errors be caught in JavaScript?](https://stackoverflow.com/questions/5963045/can-syntax-errors-be-caught-in-javascript)

2. ç±»å‹é”™è¯¯ `TypeError`
3. å¼•ç”¨é”™è¯¯ `ReferenceError`
4. èŒƒå›´é”™è¯¯ `RangeError`

> è¿™äº›é”™è¯¯å¯ä»¥é€šè¿‡ `window.onerror` æ•è·ï¼š
> 
> ```javascript
> window.onerror = function (message, source, lineno, colno, error) {
>   console.log('æ•è·åˆ°å¼‚å¸¸ï¼š', { message, source, lineno, colno, error })
> }
> // TypeError å¯ä»¥æ•è· âœ…
> const notdefined = 1
> console.log(notdefined.a.b)
> 
> // ReferenceError å¯ä»¥æ•è· âœ…
> console.log(notdefined)
> 
> // RangeError å¯ä»¥æ•è· âœ…
> console.log(new Array(-1))
> ```

### èµ„æºé”™è¯¯

èµ„æºé”™è¯¯ä¸€èˆ¬æŒ‡å›¾ç‰‡ã€scriptã€css åŠ è½½é”™è¯¯ï¼Œè¿™äº›é”™è¯¯ä¸èƒ½é€šè¿‡ `window.onerror` æ•è·ï¼Œéœ€è¦ä½¿ç”¨ `window.addEventListener` æ•è·ï¼š

```html
<script>
// èµ„æºé”™è¯¯ï¼Œä¸èƒ½æ•è· âŒ
window.onerror = function (message, source, lineno, colno, error) {
  console.log('æ•è·åˆ°å¼‚å¸¸ï¼š', { message, source, lineno, colno, error })
  return true
}

// å›¾ç‰‡ã€scriptã€cssåŠ è½½é”™è¯¯ï¼Œéƒ½èƒ½è¢«æ•è· âœ…
window.addEventListener(
  'error',
  (error) => {
    console.log('æ•è·åˆ°å¼‚å¸¸ï¼š', error)
  },
  true
)
</script>
<img src="https://yun.tuia.cn/image/kkk.png" />
<script src="https://yun.tuia.cn/foundnull.js"></script>
<link href="https://yun.tuia.cn/foundnull.css" rel="stylesheet" />
```

> ä¸ºä»€ä¹ˆ `window.onerror` ä¸èƒ½æ•è·èµ„æºé”™è¯¯ï¼Œè€Œ `window.addEventListener` å¯ä»¥æ•è·èµ„æºé”™è¯¯ï¼Ÿ
> ğŸš§ WIP

### æœªæ•è·çš„ Promise é”™è¯¯

```html
<script>
  // å…¨å±€ç»Ÿä¸€å¤„ç†Promise
  window.addEventListener("unhandledrejection", function(e){
    console.log('æ•è·åˆ°å¼‚å¸¸ï¼š', e);
  });
  fetch('https://wukaipeng.com/test')
</script>
```

### React é”™è¯¯

ä¸»è¦ä½¿ç”¨ `componentDidCatch` [æ–¹æ³•](https://react.dev/reference/react/Component#componentdidcatch)æ•è· React é”™è¯¯ï¼š

```jsx
import * as React from 'react';

class ErrorListening extends React.Component { 
    constructor(props) { 
        super(props); 
    }
    componentDidCatch(error, info) { 
        console.log("error", error)
    }
}
```

åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ï¼š

```jsx
import React from "react"; 

<ErrorListening> 
    <App /> 
</ErrorListening>
```

### Vue é”™è¯¯

Vue ä½¿ç”¨ `app.config.errorHandler` é…ç½®å…¨å±€é”™è¯¯å¤„ç†å‡½æ•°ï¼š
```javascript
app.config.errorHandler = (err, instance, info) => {
  // handle error, e.g. report to a service
}
```

## 2. ä¸ŠæŠ¥

ä½¿ç”¨ $1\times1$px çš„é€æ˜ GIF å›¾ç‰‡ä¸ŠæŠ¥é”™è¯¯ï¼š

1. ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ GET/POST/HEAD ä¸ŠæŠ¥é”™è¯¯ï¼Ÿå› ä¸ºå­˜åœ¨è·¨åŸŸé—®é¢˜ï¼Œä¸€èˆ¬ä¸ŠæŠ¥æ¥å£å’Œå½“å‰ä¸šåŠ¡éƒ½æ˜¯ä¸åŒåŸŸ
2. ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ JS/CSS/TTF å…¶ä»–èµ„æºä¸ŠæŠ¥å‘¢ï¼Ÿå› ä¸ºå…¶ä»–èµ„æºéœ€è¦åˆ›å»ºå…ƒç´ èŠ‚ç‚¹å¹¶æ’å…¥åˆ° DOM ä¸­æ‰ä¼šå‘é€è¯·æ±‚ï¼Œè€Œä¸” JS/CSS ä¼šé˜»å¡æ¸²æŸ“ä¸»çº¿ç¨‹ã€‚å›¾ç‰‡åªéœ€è¦ `new Image()` å³å¯å‘é€è¯·æ±‚ï¼Œä¹Ÿä¸ä¼šé˜»å¡æ¸²æŸ“ä¸»çº¿ç¨‹ã€‚
3. ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ PNG/JPEG/BMP æ–‡ä»¶æ ¼å¼å‘¢ï¼Ÿé¦–å…ˆ $1\times1$px çš„å›¾ç‰‡ä½“ç§¯æ˜¯æœ€å°çš„åˆæ³•å›¾ç‰‡ï¼Œåªéœ€è¦é€æ˜è‰²ï¼Œä¸éœ€è¦é¢œè‰²ï¼Œæ‰€ä»¥æ’é™¤ JPEGï¼Œå…¶æ¬¡ GIF æ¯” PNG/BMP æ›´å°ã€‚
## Reference
[ä¸€ç¯‡è®²é€è‡ªç ”çš„å‰ç«¯é”™è¯¯ç›‘æ§](https://juejin.cn/post/6987681953424080926)