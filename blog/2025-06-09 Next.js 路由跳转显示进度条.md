---
slug: nextjs-router-progress
draft: true
---

å“ˆå–½ï¼Œæˆ‘æ˜¯æ¥·é¹ã€‚

å…ˆæ¥çœ‹ä¸€ä¸ªåé¢æ•™æã€‚

åœ¨ Dify.ai ä¸­ï¼Œå½“ç‚¹å‡»è·³è½¬é¡µé¢ä¹‹åï¼Œä¼šæœ‰ä¸€æ®µéœ€è¦ç­‰å¾…çš„æ—¶é—´ï¼Œç„¶åæ‰ä¼šè·³è½¬é¡µé¢ã€‚

ç„¶è€Œï¼Œä¸­é—´è¿™æ®µæ—¶é—´æˆ‘å¹¶ä¸çŸ¥é“æ˜¯å¦è·³è½¬æˆåŠŸäº†ï¼Œæ‰€ä»¥æˆ‘ä¼šå¤šç‚¹äº†å‡ ä¸‹ï¼Œç›´åˆ°è·³è½¬ã€‚

è¿™ç§ä½“éªŒå¾ˆä¸å¥½ ğŸ‘

è§£å†³æ–¹æ¡ˆå¾ˆç®€å•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ GitHub çš„è·³è½¬äº¤äº’ã€‚

// TODO

å¯ä»¥çœ‹åˆ°ï¼ŒGitHub åœ¨è·³è½¬æœŸé—´ï¼Œä¼šæ˜¾ç¤ºä¸€ä¸ªè¿›åº¦æ¡ï¼Œæ¸…æ™°åœ°å‘Šè¯‰ç”¨æˆ·â€”â€”â€œæˆ‘æ­£åœ¨è·³è½¬ï¼Œè¯·ç¨ç­‰â€ã€‚

é‚£ä¹ˆåœ¨ Next.js ä¸­ï¼Œå¦‚ä½•å®ç°è¿™ä¸ªæ•ˆæœå‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥å€ŸåŠ© [BProgress](https://bprogress.vercel.app/) è¿™ä¸ªåº“æ¥å®ç°ã€‚

BProgress æ˜¯ä¸€ä¸ªè½»é‡çº§çš„è¿›åº¦æ¡ç»„ä»¶åº“ï¼Œæ”¯æŒ Next.js 15+ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ Remixã€Vue ç­‰å…¶ä»–æ¡†æ¶ã€‚

å¯¹äº BProgress çš„ä½¿ç”¨ï¼Œæˆ‘åšäº†ä¸€ä¸ª demo é¡¹ç›® [nextjs-progress-bar-demo](https://github.com/wukaipeng-dev/nextjs-progress-bar-demo)ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªé¡¹ç›®å…ˆ clone ä¸‹æ¥ï¼š

```bash
git clone git@github.com:wukaipeng-dev/nextjs-progress-bar-demo.git
```

ç„¶åè¿›å…¥é¡¹ç›®ç›®å½•ï¼š

```bash
cd nextjs-progress-bar-demo
```

å…ˆå®‰è£…ä¾èµ–ï¼š

```bash
npm install @bprogress/next
```

å¯åŠ¨é¡¹ç›®ï¼š

```bash
npm run dev
```

// TODO

å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„ Next.js é¡¹ç›®ï¼ŒåŒ…å«ä¸‰ä¸ªé¡µé¢ï¼šé¦–é¡µã€ç™»å½•é¡µã€æ³¨å†Œé¡µã€‚

`main` åˆ†æ”¯å·²ç»é…ç½®å¥½äº†è¿›åº¦æ¡ï¼Œæˆ‘ä»¬åˆ‡æ¢åˆ°åˆ†æ”¯ `without-progress-bar-demo`ï¼š

```bash
git checkout without-progress-bar-demo
```

å½“å‰åˆ†æ”¯ä¸‹ï¼Œæˆ‘ä»¬æ²¡æœ‰é…ç½®è¿›åº¦æ¡ï¼Œæ‰€ä»¥è·³è½¬é¡µé¢æ—¶ï¼Œä¸ä¼šæ˜¾ç¤ºè¿›åº¦æ¡ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨æ ¹å¸ƒå±€ `app/layout.tsx` ä¸­å¼•å…¥ `ProgressProvider`ï¼š

```tsx {4,14-21}
'use client';

import "./globals.css";
import { ProgressProvider } from '@bprogress/next/app';

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body>
        <ProgressProvider
          height="4px"
          color="#4c3aed"
          options={{ showSpinner: false }}
          shallowRouting
          >
          {children}
        </ProgressProvider>
      </body>
    </html>
  );
}
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ï¼Œåœ¨é¦–é¡µå’Œç™»å½•é¡µã€ç™»å½•é¡µå’Œæ³¨å†Œé¡µä¹‹é—´è·³è½¬ï¼Œéƒ½ä¼šæ˜¾ç¤ºä¸€ä¸ªè¿›åº¦æ¡ã€‚

// TODO

`ProgressProvider` çš„å‚æ•°å¦‚ä¸‹ï¼š

- `height`ï¼šè¿›åº¦æ¡çš„é«˜åº¦
- `color`ï¼šè¿›åº¦æ¡çš„é¢œè‰²
- `options`ï¼šè¿›åº¦æ¡çš„é…ç½®ï¼Œè¿™é‡Œ `showSpinner` è®¾ç½®ä¸º `false`ï¼Œè¡¨ç¤ºä¸æ˜¾ç¤ºä¸€ä¸ªåŠ¨ç”»çš„åŠ è½½å›¾æ ‡ã€‚
- `shallowRouting`ï¼šæ˜¯å¦å¯ç”¨æµ…å±‚è·¯ç”±ï¼Œå¦‚æœå¼€å¯çš„è¯ï¼Œåªæ”¹å˜è·¯ç”±çš„ query å‚æ•°ï¼Œæ¯”å¦‚ `?page=1` å˜æˆ `?page=2`ï¼Œé‚£ä¹ˆè¿›åº¦æ¡ä¸ä¼šé‡æ–°åŠ è½½ã€‚

ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬ç™»å½•æˆåŠŸä¹‹åï¼Œå†ç‚¹å‡»è·³è½¬ï¼Œå´ä¸ä¼šæ˜¾ç¤ºè¿›åº¦æ¡ã€‚

// TODO

è¿™æ˜¯å› ä¸ºï¼Œé¦–é¡µå’Œç™»å½•é¡µã€ç™»å½•é¡µå’Œæ³¨å†Œé¡µä¹‹é—´ï¼Œæ˜¯ä½¿ç”¨ `<Link>` ç»„ä»¶è¿›è¡Œè·³è½¬çš„ã€‚

`<Link>` ç»„ä»¶å®é™…ä¼šæ¸²æŸ“æˆ `<a>`ï¼ŒBProgress é€šè¿‡ç»™æ‰€æœ‰ `<a>` ç»„ä»¶æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œæ¥æ˜¾ç¤ºè¿›åº¦æ¡ã€‚

æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹åœ¨ DevTools â†’ Elements â†’ `<a>` â†’ Event Listeners ä¸­ï¼Œæ˜¯å¦æ·»åŠ äº†ç‚¹å‡»äº‹ä»¶ï¼š=

// TODO

ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬ç™»å½•æˆåŠŸä¹‹åï¼Œåˆ™æ˜¯ä½¿ç”¨ `router.push` è¿›è¡Œè·³è½¬çš„ã€‚

BProgress ä¸ä¼šç»™ `router.push` æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šæ˜¾ç¤ºè¿›åº¦æ¡ã€‚

ä¸ç”¨æ…Œï¼ŒBProgress ä¸ºæˆ‘ä»¬æä¾›äº† `useRouter` æ–¹æ³•ã€‚

å°† Next.js çš„ `useRouter` æ›¿æ¢ä¸º BProgress æä¾›çš„ `useRouter`ï¼š

```tsx
// import { useRouter } from 'next/navigation';
import { useRouter } from '@bprogress/next/app';
```

ç„¶åï¼Œæ­£å¸¸ä½¿ç”¨å³å¯ï¼š

```tsx
const router = useRouter();

router.push('/');
```

è¿™æ—¶ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç™»å½•æˆåŠŸä¹‹åï¼Œè‡ªåŠ¨è·³è½¬é¦–é¡µæ—¶ï¼Œè¿›åº¦æ¡å°±èƒ½æ­£å¸¸æ˜¾ç¤ºäº†ã€‚

// TODO

ä½†å¦‚æœä½ çš„é¡¹ç›®å·²ç»å°è£…è¿‡äº†è‡ªå·±çš„ `useRouter`ï¼Œé‚£ä¹ˆä½ å¯ä»¥å°†å°è£…è¿‡çš„ `useRouter` ä½œä¸ºå‚æ•° `customRouter` ä¼ å…¥ï¼Œè¿›è¡ŒäºŒæ¬¡å°è£…ï¼š

```tsx {6}
import { useRouter } from '@bprogress/next/app';
import { useRouter as useNextIntlRouter } from '@/i18n/navigation';

export default function Home() {
  const router = useRouter({
    customRouter: useNextIntlRouter,
  });

  return (
    <button
      onClick={() =>
        router.push('/about', {
          startPosition: 0.3,
          locale: 'en',
        })
      }
    >
      Go to about page
    </button>
  );
}
```

æœ€åï¼Œè®©æˆ‘ä»¬å›åˆ° `app/layout.tsx`ï¼Œè¿™é‡Œæˆ‘ä»¬å¼•å…¥äº† `ProgressProvider`ï¼Œä½†å´æŠŠ `app/layout` å˜æˆäº†ä¸€ä¸ªå®¢æˆ·ç«¯ç»„ä»¶ï¼Œæˆ‘ä»¬æ¥æŠŠ `ProgressProvider` æŠ½ç¦»åˆ°å…¶ä»–åœ°æ–¹ï¼Œä»ç„¶ä¿æŒ `app/layout` æ˜¯ä¸€ä¸ªæœåŠ¡ç«¯ç»„ä»¶ã€‚

```tsx
// app/components/ProgressWrapper.tsx
'use client';

import { ProgressProvider } from '@bprogress/next/app';

interface ProgressWrapperProps {
  children: React.ReactNode;
}

export function ProgressWrapper({ children }: ProgressWrapperProps) {
  return (
    <ProgressProvider
      height="4px"
      color="#0000ff"
      options={{ showSpinner: false }}
      shallowRouting
    >
      {children}
    </ProgressProvider>
  );
}
```

åœ¨ `app/layout.tsx` ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥ `ProgressWrapper`ï¼š

```tsx
import { ProgressWrapper } from './components/ProgressWrapper';

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body>
        <ProgressWrapper>
          {children}
        </ProgressWrapper>
      </body>
    </html>
  );
}
```

å¥½çš„ï¼Œä¸æ„§æ˜¯ä½ ï¼Œå®Œæˆäº†ä¸€ä¸ª Next.js é›†æˆè·¯ç”±è·³è½¬æ˜¾å¼è¿›åº¦æ¡çš„å°è£…ã€‚

ä»¥ä¸Šå°±æ˜¯æœ¬æœŸçš„å…¨éƒ¨å†…å®¹ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚

æ„Ÿè°¢è§‚çœ‹ï¼ğŸ‘







