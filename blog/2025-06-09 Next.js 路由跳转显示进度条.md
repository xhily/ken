---
slug: nextjs-router-progress
draft: true
---

哈喽，我是楷鹏。

先来看一个反面教材。

在 Dify.ai 中，当点击跳转页面之后，会有一段需要等待的时间，然后才会跳转页面。

然而，中间这段时间我并不知道是否跳转成功了，我会多点了几下，直到跳转。

这种体验很不好 👎

解决方案很简单，我们看一下 GitHub 的跳转交互。

它会在跳转之前，显示一个进度条，清晰地告诉用户，我正在跳转，请稍等。

那么在 Next.js 中，如何实现这个效果呢？

我们可以借助 [BProgress](https://bprogress.vercel.app/) 来实现。

先安装依赖：

```bash
npm install @bprogress/next
```

接下来我们在根布局 `app/layout.tsx` 中引入：

```tsx {4,14-21}
'use client';

import "./globals.css";
import { ProgressProvider } from '@bprogress/next/app';

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body>
        <ProgressProvider
          height="4px"
          color="#0000ff"
          options={{ showSpinner: false }}
          shallowRouting
          >
          {children}
        </ProgressProvider>
      </body>
    </html>
  );
}
```

接下来，我们就可以看到，在首页和登录页、登录页和注册页之间跳转，都会显示一个进度条。

// TODO

但是，当我们登录成功之后，再点击跳转，缺不会显示进度条。

这是因为，首页和登录页、登录页和注册页之间，是使用 `<Link>` 组件进行跳转的。

BProgress 会给所有 `<Link>` 组件添加点击事件，然后显示进度条。

// TODO

但是，当我们登录成功之后，则是使用 `router.push` 进行跳转的。

BProgress 不会给 `router.push` 添加点击事件，自然不会显示进度条。

不用慌，我们改为 BProgress 提供的 `useRouter` 就可以啦。

```tsx
// import { useRouter } from 'next/navigation';
import { useRouter } from '@bprogress/next/app';
```

这是，你可以看到，在登录成功之后，再点击跳转，就会显示进度条了。

// TODO

但如果你的项目已经封装过了自己的 `useRouter`，那么你可以将其作为参数 `customRouter`传入进行二次封装：

```tsx {6}
import { useRouter } from '@bprogress/next/app';
import { useRouter as useNextIntlRouter } from '@/i18n/navigation';

export default function Home() {
  const router = useRouter({
    customRouter: useNextIntlRouter,
  });

  return (
    <button
      onClick={() =>
        router.push('/about', {
          startPosition: 0.3,
          locale: 'en',
        })
      }
    >
      Go to about page
    </button>
  );
}
```

最后，我已上传到仓库：[nextjs-progress-bar-demo](https://github.com/wukaipeng-dev/nextjs-progress-bar-demo)。







